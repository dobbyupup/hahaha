<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>快乐就是哈哈哈｜段子轮播</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {
              bg: '#0a0a0a',
              fg: '#ffffff',
              soft: '#1a1a1a',
              mute: '#9ca3af'
            }
          },
          boxShadow: {
            soft: '0 10px 30px rgba(0,0,0,0.15)'
          }
        }
      }
    }
  </script>
  <style>
    /* 平滑进出场动画 */
    .fade-enter { opacity: 0; transform: translateY(8px); }
    .fade-enter-active { opacity: 1; transform: translateY(0); transition: all 500ms ease; }
    .fade-exit { opacity: 1; transform: translateY(0); }
    .fade-exit-active { opacity: 0; transform: translateY(-8px); transition: all 400ms ease; }
  </style>
</head>
<body class="min-h-dvh bg-black text-white selection:bg-white selection:text-black">
  <!-- 顶部导航 -->
  <header class="sticky top-0 z-40 border-b border-white/10 backdrop-blur">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="flex h-16 items-center justify-between">
        <a href="#" class="inline-flex items-center gap-3 group" aria-label="首页 - 快乐就是哈哈哈">
          <span class="h-9 w-9 grid place-items-center rounded-full bg-white text-black font-bold">哈</span>
          <div class="leading-tight">
            <div class="font-semibold tracking-tight">快乐就是哈哈哈</div>
            <div class="text-xs text-white/60">极简 · 纯 HTML + Tailwind</div>
          </div>
        </a>
        <nav class="flex items-center gap-2 sm:gap-4">
          <button id="viewJokesBtn" class="px-3 py-2 text-sm rounded-xl hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/20">段子</button>
          <button id="viewFavsBtn" class="px-3 py-2 text-sm rounded-xl hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/20">收藏</button>
          <div class="w-px h-6 bg-white/10 mx-1"></div>
          <button id="loginBtn" class="px-3 py-2 text-sm rounded-xl bg-white text-black font-medium hover:opacity-90 hidden">登录</button>
          <div id="userMenu" class="relative">
            <button id="userBtn" class="hidden px-3 py-2 text-sm rounded-xl bg-white/10 hover:bg-white/20 aria-expanded=false">👤 <span id="usernameText" class="ml-1 align-middle"></span></button>
            <div id="userDropdown" class="hidden absolute right-0 mt-2 w-48 rounded-xl bg-white text-black shadow-soft overflow-hidden">
              <button id="logoutBtn" class="w-full text-left px-4 py-3 text-sm hover:bg-black/5">退出登录</button>
              <button id="clearFavBtn" class="w-full text-left px-4 py-3 text-sm hover:bg-black/5">清空收藏</button>
            </div>
          </div>
        </nav>
      </div>
    </div>
  </header>

  <!-- 主体区域 -->
  <main class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8">
    <!-- 进度条 -->
    <div class="h-1 w-full bg-white/10 rounded-full overflow-hidden mt-8" aria-hidden="true">
      <div id="progress" class="h-full w-0 bg-white"></div>
    </div>

    <!-- 段子卡片 -->
    <section id="jokesSection" class="relative mt-8">
      <article aria-live="polite" aria-atomic="true" class="rounded-3xl border border-white/10 bg-white/5 p-8 md:p-12 shadow-soft">
        <div class="flex items-start justify-between gap-4">
          <div class="text-sm uppercase tracking-widest text-white/50">今日笑点</div>
          <button id="favBtn" class="inline-flex items-center gap-2 rounded-xl border border-white/10 px-3 py-2 hover:bg-white hover:text-black transition" aria-pressed="false" title="收藏/取消收藏">
            <span id="favIcon">☆</span><span class="text-sm">收藏</span>
          </button>
        </div>
        <div id="jokeText" class="mt-6 text-2xl md:text-3xl leading-relaxed font-medium"></div>
        <div class="mt-6 flex items-center justify-between text-sm text-white/60">
          <div>
            <span id="jokeIndex">1</span>/<span id="jokeTotal">—</span>
            <span class="mx-2">·</span>
            <span>每 1 分钟自动更换</span>
          </div>
          <div class="flex items-center gap-2">
            <button id="prevBtn" class="px-3 py-2 rounded-lg hover:bg-white/10">上一条</button>
            <button id="nextBtn" class="px-3 py-2 rounded-lg hover:bg-white/10">下一条</button>
            <button id="pauseBtn" class="px-3 py-2 rounded-lg hover:bg-white/10">暂停</button>
          </div>
        </div>
      </article>
    </section>

    <!-- 收藏列表 -->
    <section id="favsSection" class="hidden mt-10">
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-semibold tracking-tight">我的收藏</h2>
        <div class="text-sm text-white/60" id="favCountLabel"></div>
      </div>
      <ul id="favList" class="mt-4 grid gap-4"></ul>
      <div id="noFavTip" class="hidden mt-8 text-center text-white/50">暂无收藏。去浏览段子，点击“收藏”保存喜欢的内容。</div>
    </section>

    <footer class="py-16 text-center text-xs text-white/40">
      © <span id="year"></span> 快乐就是哈哈哈 · 极简黑白风 · 纯 HTML + TailwindCSS
    </footer>
  </main>

  <!-- 登录对话框 -->
  <div id="loginModal" class="fixed inset-0 hidden items-center justify-center bg-black/60 p-4 z-50" role="dialog" aria-modal="true">
    <div class="w-full max-w-md rounded-2xl bg-white text-black p-6 shadow-soft">
      <div class="flex items-start justify-between">
        <h3 class="text-lg font-semibold">登录</h3>
        <button id="loginClose" class="p-2 -m-2" aria-label="关闭">✕</button>
      </div>
      <p class="mt-1 text-sm text-gray-600">为了保存收藏，我们采用本地安全登录（仅保存在你的浏览器）。</p>
      <form id="loginForm" class="mt-6 space-y-4">
        <div>
          <label class="block text-sm mb-1" for="loginName">用户名</label>
          <input id="loginName" required autocomplete="username" class="w-full rounded-xl border border-black/10 px-3 py-2 outline-none focus:ring-2 focus:ring-black/10" placeholder="如：hahaha" />
        </div>
        <div>
          <label class="block text-sm mb-1" for="loginPass">密码</label>
          <input id="loginPass" type="password" required autocomplete="current-password" class="w-full rounded-xl border border-black/10 px-3 py-2 outline-none focus:ring-2 focus:ring-black/10" placeholder="最少 4 位" minlength="4" />
        </div>
        <button class="w-full rounded-xl bg-black text-white py-2.5 hover:opacity-90">进入</button>
      </form>
      <p class="mt-3 text-xs text-gray-500">提示：此登录仅用于在本地设备区分用户与收藏，不会上传到服务器。</p>
    </div>
  </div>

  <script>
    // ---------------- 基础数据（示例段子，可替换为你的内容） ----------------
    const JOKES = [
  `朋友问我：“你为什么总是笑？” 我说：“因为哭太贵了，护肤品承受不起。”`,
  `今天决定减肥，于是我把体重秤藏了起来。问题解决了！`,
  `面试官：你的优点？我：会自我反省。面试官：缺点？我：反省后也不改。`,
  `健身卡买了三年，教练说我很稳定，我觉得他话里有话。`,
  `存款和身高一样，都是我不愿意提起的话题。`,
  `一哥们在路上 与一美女搭讪 说：美女你真漂亮， 请问你是做什么工作的。 美女说 我是干服务工作的 这哥们欣喜的说： 我好想成为你的顾客！请问你在哪里上班 美女说 我在火葬场服务 你啥时候能过来`,
  `我每日劳碌，朝五晚九还要加班。 我寻至寺庙，向大师倾诉:“大师，我已看透尘世纷扰，愿出家。” 大师边为我剃发，边含泪戏言：“孩子，你每月皆来此地，山下理发店有那么贵吗?`,
  `记者街头采访:“大妈，您觉得雾霾给您的生活带来了什么影响?” 大妈:“影响太大了!首先你得看清楚，我是你大爷!”`,
  `我爸喜欢吃肉，我妈今天只炒了几个素菜 我爸抱怨说，怎么只有素菜啊！ 我妈说:"爱吃不吃，不吃喂狗"说着说着就把菜就夹到了我碗里.`,
  `去找老板申请补休，进了办公室听到一同事说：好的，明天我休。 我连忙说：明天我也想休。 老板愣了一下说：好吧明天你俩一起，那马桶能修就修，不能修就换一个。`,
  `晏子使楚，晏子被人羞辱后离开, 有认识晏子的大臣一听， 急忙去追，说 晏子！晏子！没有你我可怎么活啊!`,
  `迪迦是哪里的，东北的， 因为我迪迦在东北。`,
  `小明生病了，吃了药却一直笑，为什么 因为医生告诉小明这药效（要笑）一小时`,
  `到了这个年纪 会在你耳边唱歌喜欢你的身体还送你包的只剩下蚊子了`,
  `到了这个年纪 会在你耳边唱歌喜欢你的身体还送你包的只剩下蚊子了`,
  `蕞近体重下降了绝对没有减肥只是偷偷把心里的十八个男人放下了`,
  `在游泳地戏水， 突然想放屁。没憋住， 身后冒起一大串泡泡。旁边小姑娘哇地一声哭了:“妈妈快跑，水开了！`,
  `我家楼下新开了一家健身房，办卡送体脂称。我一上去，体脂称显示“连接失败”，我很感动：连机器都拒绝和我建立过于亲密的关系。教练看我犹豫，拍着胸脯说：“放心，我们保证让你瘦下来。”我问怎么保证？他说：“我们把镜子调得特别瘦。”`,
  `看着刚出生不到一个月的外甥女， 我摸着她的小脸说:“这个小脸又嫩又滑肉又为，跟蛋白一样，看这小胳膊胖的一轱辘一轱辘的， 跟去了皮的莲藕一样，还有这小脚丫胖的跟小猪蹄似的。" 这时我姐赶紧抱起孩子警惕的看着我说:“你是不是饿了，锅里还有剩饭....."`,
  `小明：我爸开兰博基尼，我妈开法拉利。 小刚：那你呢？ 小明：我开玩笑！`,
  `一天，蟑螂叫蜈蚣出去玩，蟑螂等了两个小时，没有耐心的说了一句:“老蜈，你怎么还没出来呀？” 蜈蚣说了一句:“等等我还在穿鞋呢！`,
  `刘备找了三个人，赢得了天下 唐僧找了三个人，取得了真经 我找了三个人，赢了我五百多`,
  `在办公室弄了个鱼缸养了几只透明的虾，领导看见了问我养的啥。 我说:“虾啊！” 我看领导脸色不太对，意识到自己说错话了，急忙解释: “领导是虾啊，真的是虾啊！”然后，第二天我就被开除了。`,
  `A:你知道为什么人和车都要靠右走？ B:因为安全！ A:NO NO NO,因为菩萨保佑！`,
  `A:先生，听说你算命挺准的，给我也算一下。 B:你呀，20岁恋爱，23岁娶妻， 4岁得子好运不断，阖家团圆。 A:扯淡，我都33岁了，博士毕业， 还没谈过恋爱。 B:你博士毕业？ A:是啊，怎么了？ B:那就对了，知识改变了你的命运。`,
  `有什么比咬开一个苹果发现里面有虫子更糟糕的事吗？" :“咬开后，发现虫子只剩半条了。`,
  `我:妈，我的旧衣服帮我打包一下，我准备捐了。 老妈:不要捐了，扔了吧。 我:别扔，还有好多吃不上饭的孩子需要呢。 老妈:谁家吃不上饭的孩子穿XXXXL？`,
  `有一次在走廊上碰到我男神，把情书塞给他就赶紧跑了， 回到教室一摸口袋，情书还在，一块钱没了。`,
  `唯一对我说过不要走的只有我的体育老师: “不要走好吗？跑起来”`,
  `老师:为什么考这么低？ 我:老师，我恐高。`,
  `A:为什么袜子总是只丢一只？ B:不知道，我也老是丢一只袜子。 A:笨蛋，因为丢两只你根本就不会发现。`,
  `A:小张很爱笑， 所以一直过不了安检。 B:为什么？ A:因为他笑里藏刀。`,
  `一哥们儿喜欢网上聊天，有次去和女网友见面，我问他什么情况？他说:“笔试通过了，面试没通。`,
  `一犯人执行枪决， 子弹质量不好， 第一枪没放出，接着又开第二枪...第三枪... 这时犯人大哭:“你掐s我吧，太吓人了！`,
  `旁边床位爸爸从孩子出生后就皱个眉，我以为他不想要闺女，结果听他给家人打电话说，孩子哪哪都挺好，就是先天残疾， 一出生就没有牙。`,
  `黄毛怪抓住了孙悟空用毫毛变出来的7个唐僧，百花公主问他为什么有七个，他说: “可能是一个疗程吧！`,
  `去鬼屋玩， 身份证掉了，然后满鬼屋的鬼都在叫我名字`,
  `有一个人臭屁声音很大，你知道为什么不？ 因为他穿着喇叭裤。`,
  `我:“老板，明天有事请假一天，望批准。" 老板:“好，你不会是去找新的工作了？” 我:“不可能，我对公司忠心耿耿，老板您说这话我就伤心了。” 老板:“关键是你简历投到了我另一家公司。” 我:“是啊，想为您出两份力。`,
  `一只蜈蚣有100条腿，在一条便便上面走过去，为什么只留下了99个脚印。 因为他要捏住鼻子。`,
  `小蚯蚓问蚯蚓妈妈:“妈妈，妈妈，爸爸去哪了？” 小蚯蚓妈妈说: “爸爸陪人钓鱼去了`,
  `你知道食人族喜欢去哪里吃饭吗？ 答案:游乐园 因为那里1.2米以下儿童免费。`,
  `如何三句话让一个男人为你花18万: 帅哥 车技不错啊 给我撞飞这么远`,
  `医生:“你老公需要绝对的安静，这是安眠药。” 女士:“谢谢医生， 我会按时给他吃的。" 医生:“喔，不！你误会了，这药是给你的。`,
  `父亲教儿子学算术 父亲:一个苹果加一个苹果是几个苹果？ 儿子:不知道。 父亲:是两个，笨蛋！知道了吗？ 儿子:知道了。 父亲:那么，我和你加起来是几个人？ 儿子:是两个笨蛋！`,
  `怎么判断一个人穿的鞋子是新的还是旧的？ 那就狠狠地踩他一脚， 如果对方说“你踩我脚了！”那就是旧鞋，如果对方说“你踩我鞋了！”那就一定是新鞋！`,
  `从前有个人姓铁，他从小就不长头发，请问他得了什么病？答案：老铁没毛病。`,
  `医生：放松，别紧张戴维，这只是一次小手术而已。病人：我不叫戴维。医生：我知道，我叫戴维。`,
  `小象找到了一个新工作，妈妈问他为什么每天下班回来都很生气，他说他在气象局。`,
  `许仙给白娘子买了一顶鸭舌帽，结果白娘子带上之后就不能动了。 一-压蛇帽`,
  `妈妈：同学说你丑？ 我：真的吗？ 妈妈：在人多的地方别叫我妈妈！`,
  `别人都是笑起来很好看，但是你却不一样，看起来很好笑。`,
  `九年义务教育教育后，我发现我可以在试卷上篡改历史，创造语言，颠覆政治，控制地球，气死牛顿，合成物质，改变基因。`,
  `你有《时间简史》吗？-我没时间捡，谁有时间捡那玩意。`,
  `有一天上课，老师问小丽：“祖国是什么?”小丽说：“老师，祖国是我的母亲。”老师说：“回答的很好。”接着老师又问小明：“小明，祖国是什么啊?”小明说：“老师，祖国是我丈母娘。`,
  `我姐考特岗教师的时候，800度近视没带眼镜，花一上午把视力表背下来了，结果测试的时候没看见棍……`,
  `昨天男神给我发短信说：“今晚我家没人”，于是我去了他家，敲了一个小时的门，果然没人。`,
  `结婚多年，睡到半夜，老公突然转过身紧紧抱住老婆说：老婆这辈子太短了。老婆醒过来听到这句话感动得掉下眼泪，老公接着说：我tm都盖不到脚。`,
  `我对老妈说：“天天在家吃都吃腻了，要不今天去外面吃？” 老妈想了想，点了点头。然后给我盛了一碗饭让我一个人去外面院子里吃。`,
  `老师问：“谁能用‘一...就...’造句？” 小明：“我一想到学习，就头疼。” 老师：“换一个。” 小明：“我一说实话，你就生气。”`,
];

    // ---------------- 状态与存储 ----------------
    const $ = (sel) => document.querySelector(sel);
    const state = {
      user: null,
      index: 0,
      intervalId: null,
      paused: false,
      progressTimer: null,
    };
    const STORAGE_KEY = 'hahaha_users'; // { [username]: { pass: string, favs: string[] } }

    function loadUsers() {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; } catch { return {}; }
    }
    function saveUsers(users) { localStorage.setItem(STORAGE_KEY, JSON.stringify(users)); }

    // 当前用户收藏相关
    function getUserFavs() { return state.user ? (loadUsers()[state.user]?.favs || []) : []; }
    function setUserFavs(nextFavs) {
      if (!state.user) return;
      const users = loadUsers();
      if (!users[state.user]) users[state.user] = { pass: '', favs: [] };
      users[state.user].favs = nextFavs;
      saveUsers(users);
      renderFavSection();
      syncFavBtn();
    }

    // ---------------- UI 渲染 ----------------
    function setText(el, text) { el.textContent = text; }

    function renderJoke() {
      const text = JOKES[state.index];
      const el = $('#jokeText');
      // 动画：
      el.classList.remove('fade-enter-active');
      el.classList.add('fade-exit');
      void el.offsetWidth; // 触发重绘
      el.classList.remove('fade-exit');
      el.classList.add('fade-enter');
      setText(el, '“' + text + '”');
      void el.offsetWidth;
      el.classList.add('fade-enter-active');

      setText($('#jokeIndex'), String(state.index + 1));
      setText($('#jokeTotal'), String(JOKES.length));
      syncFavBtn();
      restartProgress();
    }

    function syncFavBtn() {
      const favs = getUserFavs();
      const id = String(state.index);
      const isFav = favs.includes(id);
      const btn = $('#favBtn');
      btn.setAttribute('aria-pressed', isFav ? 'true' : 'false');
      $('#favIcon').textContent = isFav ? '★' : '☆';
      btn.querySelector('span:last-child').textContent = isFav ? '已收藏' : '收藏';
    }

    function renderFavSection() {
      const list = $('#favList');
      const favs = getUserFavs();
      list.innerHTML = '';
      $('#favCountLabel').textContent = `${favs.length} 条`;
      $('#noFavTip').classList.toggle('hidden', favs.length !== 0);
      favs.forEach((idStr) => {
        const idx = parseInt(idStr, 10);
        const li = document.createElement('li');
        li.className = 'rounded-2xl border border-white/10 bg-white/5 p-5';
        li.innerHTML = `
          <div class="text-sm text-white/60 mb-2">第 ${idx + 1} 条</div>
          <div class="text-lg leading-relaxed">“${JOKES[idx]}”</div>
          <div class="mt-4 flex gap-2">
            <button data-jump="${idx}" class="px-3 py-2 rounded-lg bg-white text-black text-sm hover:opacity-90">跳转播放</button>
            <button data-remove="${idx}" class="px-3 py-2 rounded-lg border border-white/10 text-sm hover:bg-white/10">取消收藏</button>
          </div>
        `;
        list.appendChild(li);
      });
    }

    // 进度条（60 秒循环）
    function restartProgress() {
      const bar = $('#progress');
      clearInterval(state.progressTimer);
      bar.style.width = '0%';
      let elapsed = 0;
      const total = 60_000; // 60 秒
      const tick = 100; // 0.1s 刷新
      state.progressTimer = setInterval(() => {
        if (state.paused) return;
        elapsed += tick;
        const pct = Math.min(100, (elapsed / total) * 100);
        bar.style.width = pct + '%';
        if (pct >= 100) clearInterval(state.progressTimer);
      }, tick);
    }

    // ---------------- 轮播控制 ----------------
    function nextJoke() {
      state.index = (state.index + 1) % JOKES.length;
      renderJoke();
    }
    function prevJoke() {
      state.index = (state.index - 1 + JOKES.length) % JOKES.length;
      renderJoke();
    }
    function startAuto() {
      clearInterval(state.intervalId);
      state.intervalId = setInterval(() => { if (!state.paused) nextJoke(); }, 60_000);
    }

    // ---------------- 登录模块（仅本地） ----------------
    function updateAuthUI() {
      const loggedIn = Boolean(state.user);
      $('#loginBtn').classList.toggle('hidden', loggedIn);
      $('#userBtn').classList.toggle('hidden', !loggedIn);
      $('#usernameText').textContent = loggedIn ? state.user : '';
    }

    function openLogin() { $('#loginModal').classList.remove('hidden'); $('#loginName').focus(); }
    function closeLogin() { $('#loginModal').classList.add('hidden'); }

    function login(username, password) {
      const users = loadUsers();
      if (!users[username]) users[username] = { pass: password, favs: [] };
      // 简易验证（仅本地用途，不要用于生产）
      if (users[username].pass !== password) {
        alert('密码不正确');
        return false;
      }
      saveUsers(users);
      state.user = username;
      updateAuthUI();
      renderFavSection();
      return true;
    }

    function logout() {
      state.user = null;
      updateAuthUI();
    }

    // ---------------- 事件绑定 ----------------
    document.addEventListener('click', (e) => {
      const t = e.target;
      if (t.id === 'nextBtn') nextJoke();
      if (t.id === 'prevBtn') prevJoke();
      if (t.id === 'pauseBtn') {
        state.paused = !state.paused;
        t.textContent = state.paused ? '继续' : '暂停';
      }
      if (t.id === 'favBtn') {
        if (!state.user) { openLogin(); return; }
        const favs = new Set(getUserFavs());
        const id = String(state.index);
        if (favs.has(id)) favs.delete(id); else favs.add(id);
        setUserFavs([...favs].sort((a,b)=>Number(a)-Number(b)));
      }
      if (t.id === 'viewFavsBtn') {
        $('#jokesSection').classList.add('hidden');
        $('#favsSection').classList.remove('hidden');
        renderFavSection();
      }
      if (t.id === 'viewJokesBtn') {
        $('#favsSection').classList.add('hidden');
        $('#jokesSection').classList.remove('hidden');
      }
      if (t.id === 'loginBtn') openLogin();
      if (t.id === 'loginClose') closeLogin();
      if (t.id === 'userBtn') {
        const dd = $('#userDropdown');
        dd.classList.toggle('hidden');
        const expanded = dd.classList.contains('hidden') ? 'false' : 'true';
        t.setAttribute('aria-expanded', expanded);
      }
      if (t.id === 'logoutBtn') { logout(); $('#userDropdown').classList.add('hidden'); }
      if (t.id === 'clearFavBtn') {
        if (!state.user) return;
        if (confirm('确认清空全部收藏？')) setUserFavs([]);
        $('#userDropdown').classList.add('hidden');
      }

      // 收藏列表中的跳转与移除
      if (t.matches('[data-jump]')) {
        const idx = Number(t.getAttribute('data-jump'));
        state.index = idx; renderJoke();
        $('#viewJokesBtn').click();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
      if (t.matches('[data-remove]')) {
        const idx = String(t.getAttribute('data-remove'));
        const favs = getUserFavs().filter(id => id !== idx);
        setUserFavs(favs);
      }
    });

    // 登录表单
    $('#loginForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const u = $('#loginName').value.trim();
      const p = $('#loginPass').value.trim();
      if (!u || !p) return;
      const ok = login(u, p);
      if (ok) closeLogin();
    });

    // 点击外部关闭下拉
    document.addEventListener('click', (e) => {
      if (!$('#userMenu').contains(e.target)) $('#userDropdown').classList.add('hidden');
    });

    // ---------------- 初始化 ----------------
    (function init() {
      setText($('#year'), new Date().getFullYear());
      renderJoke();
      startAuto();
      updateAuthUI();
    })();
  </script>
</body>
</html>

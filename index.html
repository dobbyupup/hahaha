<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>å¿«ä¹å°±æ˜¯å“ˆå“ˆå“ˆï½œæ®µå­è½®æ’­</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {
              bg: '#0a0a0a',
              fg: '#ffffff',
              soft: '#1a1a1a',
              mute: '#9ca3af'
            }
          },
          boxShadow: {
            soft: '0 10px 30px rgba(0,0,0,0.15)'
          }
        }
      }
    }
  </script>
  <style>
    /* å¹³æ»‘è¿›å‡ºåœºåŠ¨ç”» */
    .fade-enter { opacity: 0; transform: translateY(8px); }
    .fade-enter-active { opacity: 1; transform: translateY(0); transition: all 500ms ease; }
    .fade-exit { opacity: 1; transform: translateY(0); }
    .fade-exit-active { opacity: 0; transform: translateY(-8px); transition: all 400ms ease; }
  </style>
</head>
<body class="min-h-dvh bg-black text-white selection:bg-white selection:text-black">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <header class="sticky top-0 z-40 border-b border-white/10 backdrop-blur">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="flex h-16 items-center justify-between">
        <a href="#" class="inline-flex items-center gap-3 group" aria-label="é¦–é¡µ - å¿«ä¹å°±æ˜¯å“ˆå“ˆå“ˆ">
          <span class="h-9 w-9 grid place-items-center rounded-full bg-white text-black font-bold">å“ˆ</span>
          <div class="leading-tight">
            <div class="font-semibold tracking-tight">å¿«ä¹å°±æ˜¯å“ˆå“ˆå“ˆ</div>
            <div class="text-xs text-white/60">æç®€ Â· çº¯ HTML + Tailwind</div>
          </div>
        </a>
        <nav class="flex items-center gap-2 sm:gap-4">
          <button id="viewJokesBtn" class="px-3 py-2 text-sm rounded-xl hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/20">æ®µå­</button>
          <button id="viewFavsBtn" class="px-3 py-2 text-sm rounded-xl hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/20">æ”¶è—</button>
          <div class="w-px h-6 bg-white/10 mx-1"></div>
          <button id="loginBtn" class="px-3 py-2 text-sm rounded-xl bg-white text-black font-medium hover:opacity-90 hidden">ç™»å½•</button>
          <div id="userMenu" class="relative">
            <button id="userBtn" class="hidden px-3 py-2 text-sm rounded-xl bg-white/10 hover:bg-white/20 aria-expanded=false">ğŸ‘¤ <span id="usernameText" class="ml-1 align-middle"></span></button>
            <div id="userDropdown" class="hidden absolute right-0 mt-2 w-48 rounded-xl bg-white text-black shadow-soft overflow-hidden">
              <button id="logoutBtn" class="w-full text-left px-4 py-3 text-sm hover:bg-black/5">é€€å‡ºç™»å½•</button>
              <button id="clearFavBtn" class="w-full text-left px-4 py-3 text-sm hover:bg-black/5">æ¸…ç©ºæ”¶è—</button>
            </div>
          </div>
        </nav>
      </div>
    </div>
  </header>

  <!-- ä¸»ä½“åŒºåŸŸ -->
  <main class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8">
    <!-- è¿›åº¦æ¡ -->
    <div class="h-1 w-full bg-white/10 rounded-full overflow-hidden mt-8" aria-hidden="true">
      <div id="progress" class="h-full w-0 bg-white"></div>
    </div>

    <!-- æ®µå­å¡ç‰‡ -->
    <section id="jokesSection" class="relative mt-8">
      <article aria-live="polite" aria-atomic="true" class="rounded-3xl border border-white/10 bg-white/5 p-8 md:p-12 shadow-soft">
        <div class="flex items-start justify-between gap-4">
          <div class="text-sm uppercase tracking-widest text-white/50">ä»Šæ—¥ç¬‘ç‚¹</div>
          <button id="favBtn" class="inline-flex items-center gap-2 rounded-xl border border-white/10 px-3 py-2 hover:bg-white hover:text-black transition" aria-pressed="false" title="æ”¶è—/å–æ¶ˆæ”¶è—">
            <span id="favIcon">â˜†</span><span class="text-sm">æ”¶è—</span>
          </button>
        </div>
        <div id="jokeText" class="mt-6 text-2xl md:text-3xl leading-relaxed font-medium"></div>
        <div class="mt-6 flex items-center justify-between text-sm text-white/60">
          <div>
            <span id="jokeIndex">1</span>/<span id="jokeTotal">â€”</span>
            <span class="mx-2">Â·</span>
            <span>æ¯ 1 åˆ†é’Ÿè‡ªåŠ¨æ›´æ¢</span>
          </div>
          <div class="flex items-center gap-2">
            <button id="prevBtn" class="px-3 py-2 rounded-lg hover:bg-white/10">ä¸Šä¸€æ¡</button>
            <button id="nextBtn" class="px-3 py-2 rounded-lg hover:bg-white/10">ä¸‹ä¸€æ¡</button>
            <button id="pauseBtn" class="px-3 py-2 rounded-lg hover:bg-white/10">æš‚åœ</button>
          </div>
        </div>
      </article>
    </section>

    <!-- æ”¶è—åˆ—è¡¨ -->
    <section id="favsSection" class="hidden mt-10">
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-semibold tracking-tight">æˆ‘çš„æ”¶è—</h2>
        <div class="text-sm text-white/60" id="favCountLabel"></div>
      </div>
      <ul id="favList" class="mt-4 grid gap-4"></ul>
      <div id="noFavTip" class="hidden mt-8 text-center text-white/50">æš‚æ— æ”¶è—ã€‚å»æµè§ˆæ®µå­ï¼Œç‚¹å‡»â€œæ”¶è—â€ä¿å­˜å–œæ¬¢çš„å†…å®¹ã€‚</div>
    </section>

    <footer class="py-16 text-center text-xs text-white/40">
      Â© <span id="year"></span> å¿«ä¹å°±æ˜¯å“ˆå“ˆå“ˆ Â· æç®€é»‘ç™½é£ Â· çº¯ HTML + TailwindCSS
    </footer>
  </main>

  <!-- ç™»å½•å¯¹è¯æ¡† -->
  <div id="loginModal" class="fixed inset-0 hidden items-center justify-center bg-black/60 p-4 z-50" role="dialog" aria-modal="true">
    <div class="w-full max-w-md rounded-2xl bg-white text-black p-6 shadow-soft">
      <div class="flex items-start justify-between">
        <h3 class="text-lg font-semibold">ç™»å½•</h3>
        <button id="loginClose" class="p-2 -m-2" aria-label="å…³é—­">âœ•</button>
      </div>
      <p class="mt-1 text-sm text-gray-600">ä¸ºäº†ä¿å­˜æ”¶è—ï¼Œæˆ‘ä»¬é‡‡ç”¨æœ¬åœ°å®‰å…¨ç™»å½•ï¼ˆä»…ä¿å­˜åœ¨ä½ çš„æµè§ˆå™¨ï¼‰ã€‚</p>
      <form id="loginForm" class="mt-6 space-y-4">
        <div>
          <label class="block text-sm mb-1" for="loginName">ç”¨æˆ·å</label>
          <input id="loginName" required autocomplete="username" class="w-full rounded-xl border border-black/10 px-3 py-2 outline-none focus:ring-2 focus:ring-black/10" placeholder="å¦‚ï¼šhahaha" />
        </div>
        <div>
          <label class="block text-sm mb-1" for="loginPass">å¯†ç </label>
          <input id="loginPass" type="password" required autocomplete="current-password" class="w-full rounded-xl border border-black/10 px-3 py-2 outline-none focus:ring-2 focus:ring-black/10" placeholder="æœ€å°‘ 4 ä½" minlength="4" />
        </div>
        <button class="w-full rounded-xl bg-black text-white py-2.5 hover:opacity-90">è¿›å…¥</button>
      </form>
      <p class="mt-3 text-xs text-gray-500">æç¤ºï¼šæ­¤ç™»å½•ä»…ç”¨äºåœ¨æœ¬åœ°è®¾å¤‡åŒºåˆ†ç”¨æˆ·ä¸æ”¶è—ï¼Œä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚</p>
    </div>
  </div>

  <script>
    // ---------------- åŸºç¡€æ•°æ®ï¼ˆç¤ºä¾‹æ®µå­ï¼Œå¯æ›¿æ¢ä¸ºä½ çš„å†…å®¹ï¼‰ ----------------
    const JOKES = [
      'æœ‹å‹é—®æˆ‘ï¼šâ€œä½ ä¸ºä»€ä¹ˆæ€»æ˜¯ç¬‘ï¼Ÿâ€ æˆ‘è¯´ï¼šâ€œå› ä¸ºå“­å¤ªè´µäº†ï¼ŒæŠ¤è‚¤å“æ‰¿å—ä¸èµ·ã€‚â€',
      'ä»Šå¤©å†³å®šå‡è‚¥ï¼Œäºæ˜¯æˆ‘æŠŠä½“é‡ç§¤è—äº†èµ·æ¥ã€‚é—®é¢˜è§£å†³äº†ï¼',
      'é¢è¯•å®˜ï¼šä½ çš„ä¼˜ç‚¹ï¼Ÿæˆ‘ï¼šä¼šè‡ªæˆ‘åçœã€‚é¢è¯•å®˜ï¼šç¼ºç‚¹ï¼Ÿæˆ‘ï¼šåçœåä¹Ÿä¸æ”¹ã€‚',
      'æˆ‘ä¸å–œæ¬¢æ—©èµ·ï¼Œä½†é—¹é’Ÿå–œæ¬¢æˆ‘ï¼Œå®ƒæ¯å¤©éƒ½æ¥æ‰¾æˆ‘èŠå¤©ã€‚',
      'å¥èº«å¡ä¹°äº†ä¸‰å¹´ï¼Œæ•™ç»ƒè¯´æˆ‘å¾ˆç¨³å®šï¼Œæˆ‘è§‰å¾—ä»–è¯é‡Œæœ‰è¯ã€‚',
      'å­˜æ¬¾å’Œèº«é«˜ä¸€æ ·ï¼Œéƒ½æ˜¯æˆ‘ä¸æ„¿æ„æèµ·çš„è¯é¢˜ã€‚',
      'ç»™å®¤å‹æ³¡äº†æ¯å’–å•¡ï¼Œä»–æ„ŸåŠ¨åœ°è¯´ï¼šè‹¦å—ï¼Ÿæˆ‘ï¼šä¸è‹¦ï¼Œå·²ç»ä¹ æƒ¯ç”Ÿæ´»çš„å‘³é“äº†ã€‚',
      'ä»Šå¤©å¿ƒæƒ…ä¸é”™ï¼Œå†³å®šå¥–åŠ±è‡ªå·±ä¸å¼€ä¼šã€‚ç»“æœè€æ¿åŒæ„äº†â€”â€”æŠŠä¼šå»¶é•¿äº†åŠå°æ—¶ã€‚',
      'æœ‹å‹è¯´æˆ‘é€‚åˆåšå‡æ³•ï¼Œäºæ˜¯æˆ‘å¼€å§‹å‡å°‘ç¤¾äº¤ã€å‡å°‘ç„¦è™‘ã€å‡å°‘èµ·åºŠæ¬¡æ•°ã€‚',
      'ç”µå­ç§¤ï¼šè¯·ä¿æŒé™æ­¢ã€‚æˆ‘ï¼šæˆ‘å·²ç»é™æ­¢ä¸åŠ¨å¾ˆå¤šå¹´äº†ï¼Œå°¤å…¶æ˜¯å­˜æ¬¾ã€‚'
    ];

    // ---------------- çŠ¶æ€ä¸å­˜å‚¨ ----------------
    const $ = (sel) => document.querySelector(sel);
    const state = {
      user: null,
      index: 0,
      intervalId: null,
      paused: false,
      progressTimer: null,
    };
    const STORAGE_KEY = 'hahaha_users'; // { [username]: { pass: string, favs: string[] } }

    function loadUsers() {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; } catch { return {}; }
    }
    function saveUsers(users) { localStorage.setItem(STORAGE_KEY, JSON.stringify(users)); }

    // å½“å‰ç”¨æˆ·æ”¶è—ç›¸å…³
    function getUserFavs() { return state.user ? (loadUsers()[state.user]?.favs || []) : []; }
    function setUserFavs(nextFavs) {
      if (!state.user) return;
      const users = loadUsers();
      if (!users[state.user]) users[state.user] = { pass: '', favs: [] };
      users[state.user].favs = nextFavs;
      saveUsers(users);
      renderFavSection();
      syncFavBtn();
    }

    // ---------------- UI æ¸²æŸ“ ----------------
    function setText(el, text) { el.textContent = text; }

    function renderJoke() {
      const text = JOKES[state.index];
      const el = $('#jokeText');
      // åŠ¨ç”»ï¼š
      el.classList.remove('fade-enter-active');
      el.classList.add('fade-exit');
      void el.offsetWidth; // è§¦å‘é‡ç»˜
      el.classList.remove('fade-exit');
      el.classList.add('fade-enter');
      setText(el, 'â€œ' + text + 'â€');
      void el.offsetWidth;
      el.classList.add('fade-enter-active');

      setText($('#jokeIndex'), String(state.index + 1));
      setText($('#jokeTotal'), String(JOKES.length));
      syncFavBtn();
      restartProgress();
    }

    function syncFavBtn() {
      const favs = getUserFavs();
      const id = String(state.index);
      const isFav = favs.includes(id);
      const btn = $('#favBtn');
      btn.setAttribute('aria-pressed', isFav ? 'true' : 'false');
      $('#favIcon').textContent = isFav ? 'â˜…' : 'â˜†';
      btn.querySelector('span:last-child').textContent = isFav ? 'å·²æ”¶è—' : 'æ”¶è—';
    }

    function renderFavSection() {
      const list = $('#favList');
      const favs = getUserFavs();
      list.innerHTML = '';
      $('#favCountLabel').textContent = `${favs.length} æ¡`;
      $('#noFavTip').classList.toggle('hidden', favs.length !== 0);
      favs.forEach((idStr) => {
        const idx = parseInt(idStr, 10);
        const li = document.createElement('li');
        li.className = 'rounded-2xl border border-white/10 bg-white/5 p-5';
        li.innerHTML = `
          <div class="text-sm text-white/60 mb-2">ç¬¬ ${idx + 1} æ¡</div>
          <div class="text-lg leading-relaxed">â€œ${JOKES[idx]}â€</div>
          <div class="mt-4 flex gap-2">
            <button data-jump="${idx}" class="px-3 py-2 rounded-lg bg-white text-black text-sm hover:opacity-90">è·³è½¬æ’­æ”¾</button>
            <button data-remove="${idx}" class="px-3 py-2 rounded-lg border border-white/10 text-sm hover:bg-white/10">å–æ¶ˆæ”¶è—</button>
          </div>
        `;
        list.appendChild(li);
      });
    }

    // è¿›åº¦æ¡ï¼ˆ60 ç§’å¾ªç¯ï¼‰
    function restartProgress() {
      const bar = $('#progress');
      clearInterval(state.progressTimer);
      bar.style.width = '0%';
      let elapsed = 0;
      const total = 60_000; // 60 ç§’
      const tick = 100; // 0.1s åˆ·æ–°
      state.progressTimer = setInterval(() => {
        if (state.paused) return;
        elapsed += tick;
        const pct = Math.min(100, (elapsed / total) * 100);
        bar.style.width = pct + '%';
        if (pct >= 100) clearInterval(state.progressTimer);
      }, tick);
    }

    // ---------------- è½®æ’­æ§åˆ¶ ----------------
    function nextJoke() {
      state.index = (state.index + 1) % JOKES.length;
      renderJoke();
    }
    function prevJoke() {
      state.index = (state.index - 1 + JOKES.length) % JOKES.length;
      renderJoke();
    }
    function startAuto() {
      clearInterval(state.intervalId);
      state.intervalId = setInterval(() => { if (!state.paused) nextJoke(); }, 60_000);
    }

    // ---------------- ç™»å½•æ¨¡å—ï¼ˆä»…æœ¬åœ°ï¼‰ ----------------
    function updateAuthUI() {
      const loggedIn = Boolean(state.user);
      $('#loginBtn').classList.toggle('hidden', loggedIn);
      $('#userBtn').classList.toggle('hidden', !loggedIn);
      $('#usernameText').textContent = loggedIn ? state.user : '';
    }

    function openLogin() { $('#loginModal').classList.remove('hidden'); $('#loginName').focus(); }
    function closeLogin() { $('#loginModal').classList.add('hidden'); }

    function login(username, password) {
      const users = loadUsers();
      if (!users[username]) users[username] = { pass: password, favs: [] };
      // ç®€æ˜“éªŒè¯ï¼ˆä»…æœ¬åœ°ç”¨é€”ï¼Œä¸è¦ç”¨äºç”Ÿäº§ï¼‰
      if (users[username].pass !== password) {
        alert('å¯†ç ä¸æ­£ç¡®');
        return false;
      }
      saveUsers(users);
      state.user = username;
      updateAuthUI();
      renderFavSection();
      return true;
    }

    function logout() {
      state.user = null;
      updateAuthUI();
    }

    // ---------------- äº‹ä»¶ç»‘å®š ----------------
    document.addEventListener('click', (e) => {
      const t = e.target;
      if (t.id === 'nextBtn') nextJoke();
      if (t.id === 'prevBtn') prevJoke();
      if (t.id === 'pauseBtn') {
        state.paused = !state.paused;
        t.textContent = state.paused ? 'ç»§ç»­' : 'æš‚åœ';
      }
      if (t.id === 'favBtn') {
        if (!state.user) { openLogin(); return; }
        const favs = new Set(getUserFavs());
        const id = String(state.index);
        if (favs.has(id)) favs.delete(id); else favs.add(id);
        setUserFavs([...favs].sort((a,b)=>Number(a)-Number(b)));
      }
      if (t.id === 'viewFavsBtn') {
        $('#jokesSection').classList.add('hidden');
        $('#favsSection').classList.remove('hidden');
        renderFavSection();
      }
      if (t.id === 'viewJokesBtn') {
        $('#favsSection').classList.add('hidden');
        $('#jokesSection').classList.remove('hidden');
      }
      if (t.id === 'loginBtn') openLogin();
      if (t.id === 'loginClose') closeLogin();
      if (t.id === 'userBtn') {
        const dd = $('#userDropdown');
        dd.classList.toggle('hidden');
        const expanded = dd.classList.contains('hidden') ? 'false' : 'true';
        t.setAttribute('aria-expanded', expanded);
      }
      if (t.id === 'logoutBtn') { logout(); $('#userDropdown').classList.add('hidden'); }
      if (t.id === 'clearFavBtn') {
        if (!state.user) return;
        if (confirm('ç¡®è®¤æ¸…ç©ºå…¨éƒ¨æ”¶è—ï¼Ÿ')) setUserFavs([]);
        $('#userDropdown').classList.add('hidden');
      }

      // æ”¶è—åˆ—è¡¨ä¸­çš„è·³è½¬ä¸ç§»é™¤
      if (t.matches('[data-jump]')) {
        const idx = Number(t.getAttribute('data-jump'));
        state.index = idx; renderJoke();
        $('#viewJokesBtn').click();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
      if (t.matches('[data-remove]')) {
        const idx = String(t.getAttribute('data-remove'));
        const favs = getUserFavs().filter(id => id !== idx);
        setUserFavs(favs);
      }
    });

    // ç™»å½•è¡¨å•
    $('#loginForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const u = $('#loginName').value.trim();
      const p = $('#loginPass').value.trim();
      if (!u || !p) return;
      const ok = login(u, p);
      if (ok) closeLogin();
    });

    // ç‚¹å‡»å¤–éƒ¨å…³é—­ä¸‹æ‹‰
    document.addEventListener('click', (e) => {
      if (!$('#userMenu').contains(e.target)) $('#userDropdown').classList.add('hidden');
    });

    // ---------------- åˆå§‹åŒ– ----------------
    (function init() {
      setText($('#year'), new Date().getFullYear());
      renderJoke();
      startAuto();
      updateAuthUI();
    })();
  </script>
</body>
</html>
